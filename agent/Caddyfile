{
  admin localhost:2019
  on_demand_tls {
    ask {$CONTROL_PLANE_URL}/api/v1/caddy/check
  }
}

:80 {
  redir https://{host}{uri} permanent
}

:443 {
  tls {
    on_demand
    issuer acme {
      dns cloudflare {$CF_API_TOKEN}
    }
  }

  log {
    output file /var/log/caddy/techulus.log {
      roll_size 50mb
      roll_keep 3
    }
    format json
  }

  respond /__caddy_health__ "ok" 200
}
